@using System.Web.Configuration
@using GrandeTravel.Entity

@{
    ViewBag.Title = "Payment";
    ViewBag.Keywords = "";
    ViewBag.Description = "";
}

@section styles {
    <link href="~/Content/clearcanvas/membership.css" rel="stylesheet" />
}

<div id="membership" class="register">
    <section>
        <section class="row">
            <div class="col-md-12 admin-form">

                <header class="register-header">
                    <div class="header">
                        <h4>Payment</h4>
                    </div>
                </header>

                <section class="row">
                    <div class="col-md-6">
                        @using (Html.BeginForm("CreateTransaction", "Payment",
                                FormMethod.Post, new
                                {
                                    id = "braintree-payment-form",
                                    @class = "form-horizontal",
                                    @role = "form",
                                    @autocomplete = "on",
                                    novalidate = "novalidate"
                                }))
                        {
                            @Html.AntiForgeryToken()

                            <fieldset>
                                <legend>Create Transaction</legend>

                                @{
                            Package package = (Package)TempData["Package"];
                                }

                                <div class="form-group">
                                    <p>Package : @package.Name</p>
                                    <p>Total Amount : @package.Amount</p>
                                </div>

                                <div class="form-group">
                                    <label class="col-md-2 control-label">Card Number</label>
                                    <div class="col-md-10">
                                        <input type="text" data-encrypted-name="number"
                                               class="form-control cc-number" id="number" pattern="\d*" x-autocompletetype="cc-number"
                                               required
                                               value="4111111111111111">
                                    </div>
                                    <div class="col-md-12 valid cc-validation">
                                        <p class="error-message">Invalid Credit Card Number</p>
                                    </div>   
                                </div>


                                <div class="form-group">
                                    <label class="col-md-2 control-label">CVV</label>
                                    <div class="col-md-10">
                                        <input type="text" data-encrypted-name="cvv"
                                               class="form-control cc-cvv" id="cvv" pattern="\d*" x-autocompletetype="cc-csc"
                                               required autocomplete="off"
                                               value="555">
                                    </div>
                                    <p class="payment-valid">Invalid CVV</p>
                                </div>

                                <div class="form-group">
                                    <label class="col-md-2 control-label">Exipry (MM/YYYY)</label>
                                    <div class="col-md-10">
                                        <input type="text" size="2" maxlength="2" autocomplete="off" data-encrypted-name="month"
                                               class="form-control" id="number" required data-numeric
                                               value="02">

                                        <input type="text" size="4" maxlength="4" autocomplete="off" data-encrypted-name="year"
                                               class="form-control" id="number" required data-numeric
                                               value="2015">
                                    </div>
                                    <p class="payment-valid">Invalid Expiry</p>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-offset-2 col-sm-10">
                                        <input type="submit" id="submit" class="btn btn-default" disabled="disabled" value="SUBMIT" />
                                    </div>
                                </div>
                            </fieldset>
                        }
                    </div>
                </section>

            </div>
        </section>
    </section>
</div>

@section Scripts {
    <script src="https://js.braintreegateway.com/v1/braintree.js"></script>
    <script src="~/Scripts/jquery.payment.js"></script>

    <script>
        $(document).ready(function () {
            var braintree = Braintree.create("@WebConfigurationManager.AppSettings["brainTreeClientSideEncryptionKey"]");
            braintree.onSubmitEncryptForm('braintree-payment-form');

            $("#submit").removeAttr("disabled");

            // Stripe validation
            $('[data-numeric]').payment('restrictNumeric');
            $('.cc-number').payment('formatCardNumber');
            $('.cc-exp').payment('formatCardExpiry');
            $('.cc-cvc').payment('formatCardCVC');

            $('#braintree-payment-form').submit(function (e) {
                e.preventDefault();
                $('input').removeClass('invalid');
                $('.validation').removeClass('passed failed');

                var cardType = $.payment.cardType($('.cc-number').val());

                $('.cc-validation').toggleClass('valid', !$.payment.validateCardNumber($('.cc-number').val()));
                //$('.cc-exp').toggleClass('invalid', !$.payment.validateCardExpiry($('.cc-exp').payment('cardExpiryVal')));
                $('.cvv-validation').toggleClass('valid', !$.payment.validateCardCVC($('.cc-cvv').val(), cardType));

                if ($('input.invalid').length) {
                    $('.validation').addClass('failed');
                } else {
                    $('.validation').addClass('passed');
                }
            });

        });


    </script>
}
